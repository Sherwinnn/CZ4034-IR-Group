<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.css"
      rel="stylesheet"
    />
    
    <title>Restaurant Reviews</title>
  </head>
  <body onload="askUserLocation()">
    <button
      data-drawer-target="default-sidebar"
      data-drawer-toggle="default-sidebar"
      aria-controls="default-sidebar"
      type="button"
      class="inline-flex items-center p-2 mt-2 ms-3 text-sm text-gray-500 rounded-lg sm:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600"
    >
      <span class="sr-only">Open sidebar</span>
      <svg
        class="w-6 h-6"
        aria-hidden="true"
        fill="currentColor"
        viewBox="0 0 20 20"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          clip-rule="evenodd"
          fill-rule="evenodd"
          d="M2 4.75A.75.75 0 012.75 4h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 4.75zm0 10.5a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5a.75.75 0 01-.75-.75zM2 10a.75.75 0 01.75-.75h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 10z"
        ></path>
      </svg>
    </button>

		<!-- Sidebar -->
    <aside
      id="default-sidebar"
      class="fixed top-0 left-0 z-40 w-64 h-screen transition-transform -translate-x-full sm:translate-x-0"
      aria-label="Sidebar"
    >
      <div class="h-full px-3 py-4 overflow-y-scroll bg-gray-50 dark:bg-gray-800">
        <ul class="space-y-2 font-medium">
          <li>
            <form id="filter-form" class="flex flex-col gap-5">

              <div class="flex flex-col">
                <div class="flex gap-2 items-center pb-2"> 
                  <svg
                    class="w-4 h-4 text-gray-500 dark:text-gray-400"
                    aria-hidden="true"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 20 20"
                  >
                    <path
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"
                    />
                  </svg>
                  <h2 class="font-bold">Search</h2>
                </div>
                	<input
                  	type="text"
										id="search-input"
										class="block w-full p-2 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
										placeholder="Search..."
									/>
							</div>


							<!-- Filter by Cuisines -->
              <div class="flex flex-col">
                <h2 class="font-bold py-2">Filter by Cuisines</h2>
                <select name="category" id="category-filter" class="bg-gray-50 border text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                  <!-- Dynamically fill these options based on your categories -->
                  <option value="NONE">NONE</option>
                  <option value="Italian">Italian</option>
                  <option value="Chinese">Chinese</option>
                  <option value="Japanese">Japanese</option>
                  <option value="Indian">Indian</option>
                  <option value="American">American</option>
                </select>
                <!-- Add more cuisine checkboxes as needed -->
              </div>

							<!-- Filter by Neighbourhood -->
              <div class="flex flex-col">
                <h2 class="font-bold py-2">Filter by Neighbourhood</h2>
                <select name="Filter_by_Neighbourhood" id="neighbourhood-filter" class="bg-gray-50 border text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                  <option value="NONE">NONE</option>
                  <option value="Orchard">Orchard</option>
                  <option value="Jurong">Jurong</option>
                  <option value="Woodlands">Woodlands</option>
                  <option value="Tampines">Tampines</option>
                  <option value="Bugis">Bugis</option>
                  <option value="Raffles">Raffles</option>
                </select>
              </div>

							<!-- Filter by distance -->
							<div class="flex flex-col">
                <h2 class="font-bold py-2" id="distance-div" >Filter by Distance</h2>
                <select name="distance" id="distance-filter" class="bg-gray-50 border text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                  <option value="NONE">NONE</option>
                  <option value="5">5 km</option>
                  <option value="10">10 km</option>
                </select>
              </div>

							<!-- FIlter by Name -->
							<div class="flex flex-col">
                <h2 class="font-bold py-2">Filter by Name</h2>
                	<input
                  	type="text"
										id="name-filter"
										class="block w-full p-2 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
										placeholder="Enter name..."
									/>
							</div>

							<!-- Sort by Options  -->
							<div class="flex flex-col">
                <h2 class="font-bold py-2">Sort by</h2>
                <select id="sort-by-option" class="bg-gray-50 border text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                  <option value="NONE">NONE</option>
                  <option value="publishedAtDate">Date of Published</option>
                  <option value="restaurant">Title</option>
                  <option value="review_stars">Rating</option>
                  <option value="qualityScore">Quality Score</option>
                </select>
              </div>
							<!-- Sort order options -->
							<div class="flex flex-col">
                <h2 class="font-bold py-2">Sort Order</h2>
                <select id="sort-order-option" class="bg-gray-50 border text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                  <option value="asc">Ascending</option>
                  <option value="desc">Descending</option>
                </select>
              </div>

              <button
                type="submit"
                class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800"
              >
                Apply Filters
              </button>
            </form>
          </li>
        </ul>
      </div>
    </aside>

    <div class="p-4 sm:ml-64">
      <div
        class="p-2"
      >
        <div class="flex mb-4 justify-center gap-2">
          <div class="border-2 rounded-lg p-1 text-xs" id="numFound">
            Number of Results: 0
          </div>
          <div class="border-2 rounded-lg p-1 text-xs" id="execTime">Execution Time: **</div>
        </div>
        <div id="search-results" class="flex flex-col gap-5 my-5">

        <!-- Search results will be displayed here -->
        </div>
      </div>
    </div>
  </div>
  
  <script>
    const askUserLocation  = ()=> {
      const location = false;
      if (confirm("Please allow Location Access.")){
        location = true;
      } else {location = false;}
    }

    document.getElementById('filter-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      // getting user inputs
      const searchInput = document.getElementById('search-input').value;
      const categoryFilter = document.getElementById('category-filter').value;
      const neighbourhoodfilter = document.getElementById('neighbourhood-filter').value;
      const distanceFilter = document.getElementById('distance-filter').value;
      const nameFilter = document.getElementById('name-filter').value;
      const sortByOption = document.getElementById('sort-by-option').value;
      const sortOrderOption = document.getElementById('sort-order-option').value;
      
      // calling api  
      const queryString = `q=${encodeURIComponent(searchInput)}&category=${encodeURIComponent(categoryFilter)}&neighbourhood=${encodeURIComponent(neighbourhoodfilter)}&distance=${encodeURIComponent(distanceFilter)}&name=${encodeURIComponent(nameFilter)}&sortBy=${encodeURIComponent(sortByOption)}&sortOrder=${encodeURIComponent(sortOrderOption)}`;
      const response = await fetch(`/search?${queryString}`);

      const searchResults = document.getElementById('search-results');
      searchResults.innerHTML = '';
      try { 
        const res = await response.json(); 
        const data = res.response;
        const execTime = res.debug.timing.time;
        const numFound = data.numFound;
        const reviews = data.docs;
        const numFoundElement = document.getElementById('numFound');
        const execTimeElement = document.getElementById('execTime');
        numFoundElement.innerHTML = `Number of Results: ${numFound}`;
        execTimeElement.innerHTML = `Execution Time: ${execTime} ms`;
        reviews.forEach((review) => {
        const resultElement = document.createElement('div');
        resultElement.classList.add("review","flex", "flex-col", "gap-2", "p-2", "border-2", "border-black", "border-dashed","rounded-lg","dark:border-gray-700");
        resultElement.innerHTML = `
            <h2 class="font-bold text-lg">${review.restaurant}</h2>
            <div class="flex gap-4 items-center">
              <div class="flex flex-row items-center justify-start gap-1">
                <img
                  class="w-4"
                  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAACXBIWXMAAAsTAAALEwEAmpwYAAABT0lEQVR4nNWWvUoDQRSFPwMRC/8bsUghMYi1IFiIWOgLCDZJreADKMRGSOMr+AAq2IiFtvoAClrbpBbEdCqiKwM3MITZZefO7kAOnO6e+8HdO7MDQ6hRcXQ9APexoQvAH5AA9ZjgI4EaH8YEP1ngx1jQugXtuxEDfOwAt2OAXxzg57KhSw5o38tlAMeAGaCTAe5IjanNrU3gDehlNA51TxgbNngR6JYITcRd14UzBVyVCL0BZrPGvgd8Fwj8kZtuJM83XwFeCxrtms+yGU0ClwHQa9lytQ5kXD6jNZlgzQG/HmBTO18EeF8xZrOgwbpTgG9DoePApwL8Jcup1m7GAp2I0xbPZNW6SDmb61bNasqZP9dCq8DHQDNzpU47aieAM8dPQfX83R5o0syR2QHerdyWBnwqYfN2rnnkapJJpIe3GkALqCiyFclGeQQyFPoHEw8YhVQOh/EAAAAASUVORK5CYII="
                />
                <p>${ review.review_stars }/5</p>
                </div>
              <p class="font-bold">Quality Score: <span class="font-normal">${review.qualityScore}</span></p>
            </div>
            <div class="flex gap-4 items-center">
              <div class="flex flex-row items-center justify-start gap-1">
                <img
                  class="w-4"
                  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAACXBIWXMAAAsTAAALEwEAmpwYAAACCklEQVR4nO2avUtbURiHn2LbRWyh4OAnDv4HnTopdCp+4FKKjjppTSz9E8R/wE6V+gEuis427tYunZz8KhVs91AjKDYh5cgbCKGYY3JO8159H/gtl+TkPDkn9773vQHDMAzD6AZSwDZwAJxLDuTYNNB1F76mDmAByAPFKikAG0APCWUEyHmIVuYMGCZhzMiK3Va2fLXTJGhlC3XIlkurX+nOGrfxTdu7HcUsB5Qt5ROKLz35CMJ52TnqSEeQLeUtCslEFN5CIccRhV1Fpo5cRGE3tjqKkaOO4n0TzkWU/Y1CDiMK76OQzH27LE1HFJ5EIV2RSss/WktLx2IE4Y8ob+mcBT47t6GcV4G2tmsADJEQ0gFaPK7LmSiGa9zebhsPklBagXk50/qs6moSfrM+dMpN/GepmnKSfSkqpjRfegzDMAwjITwFxoBNYA14VsMY7j3rMsYo8ARlPATeSFFxWVE9/QTGgUce4zwGJoBfFWNcSnHyGmiigbQA74ATj7LxVErMAaAXaJb0yrEP8ppq4/yQZ8/us//rir4HshFu9n2TlTm4uUTlOfCtgaKV2QNexBB9AMwFerIfOm5OszLHYLIrCsSqZSmUdEqBjG9cq7huvisQ8c1RCOELBSK+cf/uq5uvCkR8sxNC+KVnT6rRuQL6QgiXpHf/UTpqiJvTF6D/eqaGYRiGYaCVv6HnqrbiWrFuAAAAAElFTkSuQmCC"
                />
                <p>${ review.reviewer }</p>
              </div>
              <div class="flex flex-row items-center justify-start gap-1">
                <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"/>
                </svg>
                <p>${new Date(review.publishedAtDate).toLocaleDateString()}</p>
              </div>
            </div>
            <div>
            <p>${ review.review }</p>
            <p>
              Cuisine: ${ review.categoryName }
            </p>
        `;
        searchResults.appendChild(resultElement);
      });
      
    } catch (error) {console.log(error)}
    

      
    });
  </script>
</body>
</html>